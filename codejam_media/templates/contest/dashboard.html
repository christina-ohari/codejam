{% extends "base_lgcj.html" %}

{% block head_scripts %}
<script type="text/javascript" src="/static/js/dashboard.js"></script>
{% endblock %}

{% block content %}
<!-- Problem Title -->
<h3 id="dsb-problem-title-area">
  <span id="dsb-problem-title-div" class="problem-title after-start-only" style="display: block;">
    <span style="color:#666">Problem {{problem.deco}}. </span> {{problem.name}}
  </span>
</h3>

<div id="dsb-problem-pages">
  {% include "problem/list.html" %}
</div>

<div id="dsb-clarification-page" class="dsb-content-pages">
  <!-- The clarifications table -->
  <div id="clarTableDiv" class="clarTableWrapper"></div><div>
    <table id="dsb-clarification-table">
      <colgroup span="9">
        <col width="16%" /><col width="2%" />
        <col width="10%" /><col width="2%" />
        <col width="28%" /><col width="2%" />
        <col width="10%" /><col width="2%" />
        <col width="28%" />
      </colgroup>
      <thead>
        <tr>
        <th>Category</th><th>&nbsp;</th>
        <th class="clarTimeColumn">Asked</th><th>&nbsp;</th>
        <th>Question</th><th>&nbsp;</th>
        <th class="clarTimeColumn">Answered</th><th>&nbsp;</th>
        <th>Answer</th>
        </tr>
      </thead>
      <tbody id="dsb-clarification-tbody">
      </tbody>
    </table>
  </div>
  <div id="dsb-submit-clarification">
    <!-- The link to ask a clarification -->
    <div style="padding: 0.5em 0 0.3em 0;">
      <b>Ask a question:</b>
    </div>
    <!-- The form for asking clarification -->
    <div>
      <form onsubmit="return GCJ.submitClarification(this);"><div style="display:none;"><input type="hidden" name="csrfmiddlewaretoken" value="NWU5NDA3OTUyOTQ2YmM0NzZhOTk0NDAwN2ZkMmI3Yzh8fDEzNjcxOTM3NDg3NDY2NzE=" /></div>
        <div><textarea rows="5" cols="60" name="q"></textarea></div>
        <div style="padding-top: 0.3em">
          <select id="dsb-clarification-problem-select" name="problem">
            <option value="_" selected>[General]</option>
          </select>
          &nbsp;
          <input id="dsb-submit-clarification-button" type="submit"
                 value="Ask" />
        </div>
      </form>
    </div>
  </div>
  <!-- Too many pending clarifications -->
  <div id="dsb-cannot-ask-question-text"
    style="font-weight: bold; padding: 0.5em 0 0.3em 0">
    
    There is a maximum of 8 pending questions.
    You can ask more questions as soon as we have responded to some of your
    questions.
    
  </div>

</div>

<div id="dsb-submissions-page" class="dsb-content-pages">
  <div id="dsb-submissions-status" class="dsb-sub-status-msg">
    You have 0 submissions.
  </div>
  <table id="dsb-submissions-table" class="dsb-sub-main-table"
         style="display:none">
  <thead>
    <tr id="dsb-sub-main-table-header">
      <th class="dsb-sub-row-id-width">ID</th>
      <th class="dsb-sub-name-width">Problem</th>
      <th class="dsb-sub-difficulty-width">Size</th>
      <th class="dsb-sub-input-width">Input</th>
      <th class="dsb-sub-output-width">Output</th>
      <th class="dsb-sub-source-width">Solution</th>
      <th class="dsb-sub-status-width">Status</th>
      <th class="dsb-sub-time-width">Time</th>
    </tr>
  </thead>
  <tbody id="dsb-submissions-rows">
  </tbody>
  </table>
</div>
{% endblock %}



{% block body_scripts %}
<script>

function initSolveButtons() {
  var keyword = 'dsb-input-start-button'
    , nodes = document.getElementsByClassName(keyword)
    , node, i, len, tmp;

  function show() {
    var suffix = this.id.slice(keyword.length);
    console.log(suffix);
    document.getElementById('dsb-input-start-button' + suffix).style.display = 'none';
    document.getElementById('dsb-input-link-plain' + suffix).style.display = 'inline';
    document.getElementById('dsb-action-box-wrap' + suffix).className = 'dsb-action-box-open';
    document.getElementById('dsb-input-table-caption' + suffix).style.display = 'inline';
    //document.getElementById('dsb-resubmit-caption' + suffix).style.display = 'inline';
    document.getElementById('dsb-submit-form-div' + suffix).style.display = 'block';
  }
  
  function submit() {
    var keyword = 'submit-buttonio_timer_'
      , index = Number(this.id.slice(keyword.length))
      , suffix = Math.floor(index / 2) + '-' + (index % 2);
      alert(suffix);
  }

  function hide() {
    var keyword = 'dsb-hide-submissionio_timer_'
      , index = Number(this.id.slice(keyword.length))
      , suffix = Math.floor(index / 2) + '-' + (index % 2);
  
    document.getElementById('dsb-input-start-button' + suffix).style.display = 'inline';
    document.getElementById('dsb-input-link-plain' + suffix).style.display = 'none';
    document.getElementById('dsb-action-box-wrap' + suffix).className = '';
    document.getElementById('dsb-input-table-caption' + suffix).style.display = 'none';
    //document.getElementById('dsb-resubmit-caption' + suffix).style.display = 'none';
    document.getElementById('dsb-submit-form-div' + suffix).style.display = 'none';
  }
  
  
  
  for (i = 0, len = nodes.length; i < len; ++i) {
    node = nodes[i];
    node.onclick = show;

    tmp = node.id.slice(keyword.length);
    tmp = Number(tmp.slice(0,1)) * 2 + Number(tmp.slice(2));
    document.getElementById('submit-buttonio_timer_' + tmp).onclick = submit;
    document.getElementById('dsb-hide-submissionio_timer_' + tmp).onclick = hide;
  }
}

function initSubmitButtons() {
  
}





function selectProblem(index, title) {
  
  var nodes, noed, i, len, tag;
  
  // side menu
  nodes  = document.getElementsByClassName('dsb-problem-tab-open');
  for (i=0, len = nodes.length; i < len; ++i) {
    nodes[i].className = 'dsb-problem-tab-close';
  }
  node = document.getElementById('dsb-problem-tab' + index);
  node.className = 'dsb-problem-tab-open';
  
  // main title
  name = node.textContent;
  name = name.slice(name.indexOf('.') + 2);
  tag = '<span style="color:#666">Problem ' + String.fromCharCode(65+index) + '.</span>&nbsp' + name;
  document.getElementById('dsb-problem-title-div').innerHTML = tag;
  
  // main content block
  nodes = document.getElementsByClassName('dsb-content-pages');
  for (i=0, len = nodes.length; i < len; ++i) {
    nodes[i].style.display = 'none';
  }
  document.getElementById('dsb-problem-page' + index).style.display = 'block';
}



function initSelector() {
  var nodes = document.getElementsByClassName('dynamic-link');
  for (var i = 0, len = nodes.length; i < len; ++i) {
    var node = nodes[i]
        , id = node.id
        , keyword = 'dsb-problem-title';
    if (id && id.slice(0, keyword.length) === keyword) {
      node.onclick = function () {
        selectProblem(Number(this.id.slice(keyword.length)));
      };
    }
  }
}



window.onload = function () {
  initSelector();
  initSolveButtons();
	selectProblem(0);
};
</script>
{% endblock %}